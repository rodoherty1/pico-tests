pico-8 cartridge // http://www.pico-8.com
version 15
__lua__

function _init()
 x = 0
 y = 0
 dx=0
 dy=0
end

function _draw()
 cls()
 rectfill(0, 0, 127, 110, 12)
 rectfill(0, 110, 127, 127, 3)
 map(0,0, 0,0, 16,16)

 spr(5, x, y)  
 print ("x:"..x.." y:"..y, 0, 0)
 print ("dx: "..dx.." dy:"..dy, 0, 8)
 print ("tile ("..flr(x/8)..", "..flr(y/8)..")", 0, 16)  
 print (collision_debug(), 0, 24)
end

function _update()
 
 local ddx=0
  
 if btn(0) then ddx-=.25
 elseif btn(1) then ddx+=.25
 elseif not btn(0) and not btn(1) then dx=0
 end

 if not collision() then
  dx+=ddx
 else 
  dx-=ddx
 end
 
-- y velocity
 if grounded() then
  if (btn(2)) then
   dy=-0.8
  else
   dy = 0
   -- fix position
   -- or else he'll be sunk into floor
   y = flr(flr(y)/8)*8
  end
 else
  -- gravity accel
  dy +=0.98
 end
 
 x+=dx
 y+=dy
 
 if (x>128) then
  x=128
  dx=0
 end
 
 if (y>128) then
  y=128
  dy=0
 end
end


-->8
function grounded() 
 local v = mget(flr(x)/8, (flr(y)/8)+1)
 return fget(v, 0)
end 

function collision_debug()
 local xy = ""..((flr(x)/8)+1)..","..flr(y/8)
 local sprite = ""
 local col = mget((flr(x)/8)+1, flr(y)/8) 
 
 if col>0 then
  sprite="collision "..col
 else
	 sprite="no collision "..col
	end
 return xy.." "..sprite
end 


function collision()
 local v = mget((flr(x)/8)+1, flr(y)/8)
 return fget(v, 1)
end

__gfx__
00000000000e0000088008800044440000aaaaaaaaaaaa0000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000ee0008800880044444400011aaaaaaaa110000000000000000000000000000000000000000000000000000000000000000000000000000000000
0070070000eee0ee08800880444444440a11aaaaaaaa11a000000000000000000000000000000000000000000000000000000000000000000000000000000000
0007700000e0e00e08888880444444440111aaaaaaaa111000000000000000000000000000000000000000000000000000000000000000000000000000000000
000770000e000e0e08888880eeeeeeeeaaaaaaaaaaaaaaaa00000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700e000eee008800880e00ee44eaaaaaaaaaaaaaaaa00000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000eeee00e008800880e00ee44e011001100110011000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000e0e00e08800880eeeee44e011001100110011000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000e0000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000e00000000000000000000000000000000000000000
000000000000000000000000000000000000000000000e000000000000000000000000000000000000000e000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000e00000000000000000000000000000000000000e0000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000e000000000000000000000000000000000000ee00000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000e0000000000000000000000000000000000e0000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000e000000000000000000000000000000000e00000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000e0000000000000000000000000000000e000000000eeeeeee00000000000000000000000000000000
000000000000000000000000000000000000000000000000e00000000000000000000000000000e000000000e0000000eeeeee00000000000000000000000000
0000000000000000000000000000000000000000000000000e00000000000000000000000000ee000000000e00000000000000ee000000000000000000000000
00000000000000000000000000000000000000000000000000ee0000000000000000000000ee0000000000e00000000000000000ee0000000000000000000000
0000000000000000000000000000000000000000000000000000ee000000000000000000ee00000000000e0000e000000000000000ee00000000000000000000
000000000000000000000000000000000000000000000000000000ee000000000000eeee000000000000e0000e000000000000000eeeee000000000000000000
00000000000000000000000000000000000000000000000000000000eeeeeeeeeeee00000000000000ee0000e000000eeeeeeeeee00000e00000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000e000e0ee000000e000000000000000ee000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000e000ee0e0000000e00000000000000000e00000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000e000e0ee000000e0000000000000000000e0000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000e000ee0e0000000e00000000000000000000e000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000e000e0eee0000000e000000000000000000000e00000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000e0000ee0e0000000e00000000000000000000000e0000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000e000e0ee00000000e00000000000000000000000e0000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000e000e0e0e00000000e000000000000000000000000e000000000
000000000000000000000000000000000000000000000000000000000000000000000000000e0000e0ee000000000e0000000000000000000000000e00000000
000000000000000000000000000000000000000000000000000000000000000000000000000e000e00e0000000000e00000000000000000000000000e0000000
00000000000000000000000000000000000000000000000000000000000000000000000000e0000e0ee0000000000e000000000000000000000000000e000000
00000000000000000000000000000000000000000000000000000000000000000000000000e000e00e00000000000e0000000000000000000000000000e00000
0000000000000000000000000000000000000000000000000000000000000000000000000e000e00ee00000000000e00000000000000000000000000000e0000
000000000000000000000000000000000000000000000000000000000000000000000000e0000e0ee000000000000e00000000000000000000000000000e0000
000000000000000000000000000000000000000000000000000000000000000000000000e000e0eee000000000000e000000000000000000000000000000e000
00000000000000000000000000000000000000000000000000000000000000000000000e000e00ee0000000000000e0000000000000000000000000000000e00
00000000000000000000000000000000000000000000000000000000000000000000000e000e0eee0000000000000e0000000000000000000000000000000e00
0000000000000000000000000000000000000000000000000000000000000000000000e000e0eee00000000000000e0000000000000000000000000000000e00
__gff__
0001020001010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000003000000000002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101010101010101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
